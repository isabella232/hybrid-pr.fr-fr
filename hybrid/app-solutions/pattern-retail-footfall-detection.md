---
title: Modèle de détection des pas à l’aide d’Azure et d’Azure Stack Hub
description: Découvrez comment utiliser Azure et Azure Stack Hub pour implémenter une solution de détection des pas basé sur l’intelligence artificielle afin d’analyser la fréquentation des magasins.
author: BryanLa
ms.topic: article
ms.date: 10/31/2019
ms.author: bryanla
ms.reviewer: anajod
ms.lastreviewed: 10/31/2019
ms.openlocfilehash: 866557ec3af2337e9f034da84cf417675508563b
ms.sourcegitcommit: 962334135b63ac99c715e7bc8fb9282648ba63c9
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/23/2021
ms.locfileid: "104895327"
---
# <a name="footfall-detection-pattern"></a><span data-ttu-id="a7a2f-103">Modèle de détection des pas</span><span class="sxs-lookup"><span data-stu-id="a7a2f-103">Footfall detection pattern</span></span>

<span data-ttu-id="a7a2f-104">Ce modèle fournit une présentation de l’implémentation d’une solution de détection de pas basée sur l’intelligence artificielle pour l’analyse du trafic des visiteurs dans les magasins.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-104">This pattern provides an overview for implementing an AI-based footfall detection solution for analyzing visitor traffic in retail stores.</span></span> <span data-ttu-id="a7a2f-105">La solution fournit des insights à partir d’actions du monde réel, en utilisant Azure, Azure Stack Hub et le kit de développement d’intelligence artificielle personnalisé Custom Vision.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-105">The solution generates insights from real world actions, using Azure, Azure Stack Hub, and the Custom Vision AI Dev Kit.</span></span>

## <a name="context-and-problem"></a><span data-ttu-id="a7a2f-106">Contexte et problème</span><span class="sxs-lookup"><span data-stu-id="a7a2f-106">Context and problem</span></span>

<span data-ttu-id="a7a2f-107">Les magasins Contoso aimeraient avoir un aperçu de la façon dont les clients accueillent leurs produits actuels par rapport à l’agencement des magasins.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-107">Contoso Stores would like to gain insights on how customers are receiving their current products in relation to store layout.</span></span> <span data-ttu-id="a7a2f-108">Ces magasins ne peuvent pas affecter du personnel dans chaque section et il serait trop fastidieux de demander à une équipe d’analystes d’examiner les séquences vidéo d’un magasin tout entier.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-108">They're unable to place staff in every section and it's inefficient to have a team of analysts review an entire store's camera footage.</span></span> <span data-ttu-id="a7a2f-109">Par ailleurs, aucun des magasins ne dispose d'une bande passante suffisante pour diffuser la vidéo de toutes les caméras dans le cloud à des fins d'analyse.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-109">In addition, none of their stores have enough bandwidth to stream video from all their cameras to the cloud for analysis.</span></span>

<span data-ttu-id="a7a2f-110">Contoso aimerait trouver une façon discrète et respectueuse de la vie privée d’identifier certaines caractéristiques de sa clientèle, notamment le nombre de clients, leur loyauté et leurs réactions face aux présentoirs et produits proposés en magasin.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-110">Contoso would like to find an unobtrusive, privacy-friendly way to determine their customers' demographics, loyalty, and reactions to store displays and products.</span></span>

## <a name="solution"></a><span data-ttu-id="a7a2f-111">Solution</span><span class="sxs-lookup"><span data-stu-id="a7a2f-111">Solution</span></span>

<span data-ttu-id="a7a2f-112">Ce modèle d’analyse commerciale utilise une approche à plusieurs niveaux pour l’inférence à la périphérie.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-112">This retail analytics pattern uses a tiered approach to inferencing at the edge.</span></span> <span data-ttu-id="a7a2f-113">En utilisant le kit de développement personnalisé Custom Vision, seules les images affichant un visage humain sont envoyées pour analyse à une instance Azure Stack Hub privée qui exécute Azure Cognitive Services.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-113">By using the Custom Vision AI Dev Kit, only images with human faces are sent for analysis to a private Azure Stack Hub that runs Azure Cognitive Services.</span></span> <span data-ttu-id="a7a2f-114">Les données anonymisées et agrégées sont envoyées à Azure pour être agrégées dans tous les magasins puis visualisées dans Power BI.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-114">Anonymized, aggregated data is sent to Azure for aggregation across all stores and visualization in Power BI.</span></span> <span data-ttu-id="a7a2f-115">La combinaison d’un cloud périphérique et d’un cloud public permet à Contoso de tirer parti de la technologie IA moderne tout en restant en conformité avec ses stratégies d’entreprise et en respectant la vie privée de ses clients.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-115">Combining the edge and public cloud lets Contoso take advantage of modern AI technology while also remaining in compliance with their corporate policies and respecting their customers' privacy.</span></span>

<span data-ttu-id="a7a2f-116">[![Solution de modèle de détection des pas](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span><span class="sxs-lookup"><span data-stu-id="a7a2f-116">[![Footfall detection pattern solution](media/pattern-retail-footfall-detection/solution-architecture.png)](media/pattern-retail-footfall-detection/solution-architecture.png)</span></span>

<span data-ttu-id="a7a2f-117">Voici un résumé du fonctionnement de la solution :</span><span class="sxs-lookup"><span data-stu-id="a7a2f-117">Here's a summary of how the solution works:</span></span>

1. <span data-ttu-id="a7a2f-118">Le kit de développement personnalisé Vision AI reçoit une configuration de la part d’IoT Hub, qui installe le runtime IoT Edge et un modèle ML.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-118">The Custom Vision AI Dev Kit gets a configuration from IoT Hub, which installs the IoT Edge Runtime and an ML model.</span></span>
2. <span data-ttu-id="a7a2f-119">Si le modèle détecte une personne, il prend une photo et la charge sur le stockage Blob Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-119">If the model sees a person, it takes a picture and uploads it to Azure Stack Hub blob storage.</span></span>
3. <span data-ttu-id="a7a2f-120">Le service Blob déclenche une fonction Azure sur Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-120">The blob service triggers an Azure Function on Azure Stack Hub.</span></span>
4. <span data-ttu-id="a7a2f-121">La fonction Azure appelle un conteneur avec l'API Visage pour obtenir des données démographiques et émotionnelles de l'image.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-121">The Azure Function calls a container with the Face API to get demographic and emotion data from the image.</span></span>
5. <span data-ttu-id="a7a2f-122">Les données sont anonymisées et envoyées à un cluster Azure Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-122">The data is anonymized and sent to an Azure Event Hubs cluster.</span></span>
6. <span data-ttu-id="a7a2f-123">Le cluster Event Hubs transmet les données à Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-123">The Event Hubs cluster pushes the data to Stream Analytics.</span></span>
7. <span data-ttu-id="a7a2f-124">Stream Analytics agrège les données et les transmet à Power BI.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-124">Stream Analytics aggregates the data and pushes it to Power BI.</span></span>

## <a name="components"></a><span data-ttu-id="a7a2f-125">Components</span><span class="sxs-lookup"><span data-stu-id="a7a2f-125">Components</span></span>

<span data-ttu-id="a7a2f-126">Cette solution utilise les composants suivants :</span><span class="sxs-lookup"><span data-stu-id="a7a2f-126">This solution uses the following components:</span></span>

| <span data-ttu-id="a7a2f-127">Couche</span><span class="sxs-lookup"><span data-stu-id="a7a2f-127">Layer</span></span> | <span data-ttu-id="a7a2f-128">Composant</span><span class="sxs-lookup"><span data-stu-id="a7a2f-128">Component</span></span> | <span data-ttu-id="a7a2f-129">Description</span><span class="sxs-lookup"><span data-stu-id="a7a2f-129">Description</span></span> |
|----------|-----------|-------------|
| <span data-ttu-id="a7a2f-130">Matériel en magasin</span><span class="sxs-lookup"><span data-stu-id="a7a2f-130">In-store hardware</span></span> | [<span data-ttu-id="a7a2f-131">Kit de développement d’intelligence artificielle personnalisé Vision AI</span><span class="sxs-lookup"><span data-stu-id="a7a2f-131">Custom Vision AI Dev Kit</span></span>](https://azure.github.io/Vision-AI-DevKit-Pages/) | <span data-ttu-id="a7a2f-132">Fournit un filtrage en magasin à l'aide d'un modèle ML local qui capture des images de personnes uniquement à des fins d'analyse.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-132">Provides in-store filtering using a local ML model that only captures images of people for analysis.</span></span> <span data-ttu-id="a7a2f-133">Configuré et mis à jour de façon sécurisée via l’IoT Hub.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-133">Securely provisioned and updated through IoT Hub.</span></span><br><br>|
| <span data-ttu-id="a7a2f-134">Azure</span><span class="sxs-lookup"><span data-stu-id="a7a2f-134">Azure</span></span> | [<span data-ttu-id="a7a2f-135">Azure Event Hubs</span><span class="sxs-lookup"><span data-stu-id="a7a2f-135">Azure Event Hubs</span></span>](/azure/event-hubs/) | <span data-ttu-id="a7a2f-136">Azure Event Hubs fournit une plate-forme évolutive pour l'acquisition de données anonymisées qui s'intègre parfaitement à Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-136">Azure Event Hubs provides a scalable platform for ingesting anonymized data that integrates neatly with Azure Stream Analytics.</span></span> |
|  | [<span data-ttu-id="a7a2f-137">Azure Stream Analytics</span><span class="sxs-lookup"><span data-stu-id="a7a2f-137">Azure Stream Analytics</span></span>](/azure/stream-analytics/) | <span data-ttu-id="a7a2f-138">Une tâche Azure Stream Analytics agrège les données anonymisées et les regroupe dans des fenêtres de 15 secondes pour les visualiser.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-138">An Azure Stream Analytics job aggregates the anonymized data and groups it into 15-second windows for visualization.</span></span> |
|  | [<span data-ttu-id="a7a2f-139">Microsoft Power BI</span><span class="sxs-lookup"><span data-stu-id="a7a2f-139">Microsoft Power BI</span></span>](https://powerbi.microsoft.com/) | <span data-ttu-id="a7a2f-140">Power BI fournit une interface de tableau de bord conviviale pour visualiser les résultats issus d’Azure Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-140">Power BI provides an easy-to-use dashboard interface for viewing the output from Azure Stream Analytics.</span></span> |
| <span data-ttu-id="a7a2f-141">Azure Stack Hub</span><span class="sxs-lookup"><span data-stu-id="a7a2f-141">Azure Stack Hub</span></span> | [<span data-ttu-id="a7a2f-142">App Service</span><span class="sxs-lookup"><span data-stu-id="a7a2f-142">App Service</span></span>](/azure-stack/operator/azure-stack-app-service-overview) | <span data-ttu-id="a7a2f-143">Le fournisseur de ressources App Service fournit une base pour les composants périphériques, notamment les fonctionnalités d’hébergement et de gestion pour les applications web/API et les fonctions.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-143">The App Service resource provider (RP) provides a base for edge components, including hosting and management features for web apps/APIs and Functions.</span></span> |
| | <span data-ttu-id="a7a2f-144">Cluster du moteur Azure Kubernetes Service [(AKS)](https://github.com/Azure/aks-engine)</span><span class="sxs-lookup"><span data-stu-id="a7a2f-144">Azure Kubernetes Service [(AKS) Engine](https://github.com/Azure/aks-engine) cluster</span></span> | <span data-ttu-id="a7a2f-145">Le fournisseur de ressources AKS avec le cluster du moteur AKS déployé dans Azure Stack Hub fournit un moteur résilient et scalable pour exécuter le conteneur de l’API Visage.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-145">The AKS RP with AKS-Engine cluster deployed into Azure Stack Hub provides a scalable, resilient engine to run the Face API container.</span></span> |
| | <span data-ttu-id="a7a2f-146">Azure Cognitive Services [Conteneurs de l’API Visage](/azure/cognitive-services/face/face-how-to-install-containers)</span><span class="sxs-lookup"><span data-stu-id="a7a2f-146">Azure Cognitive Services [Face API containers](/azure/cognitive-services/face/face-how-to-install-containers)</span></span>| <span data-ttu-id="a7a2f-147">Le fournisseur de ressources Azure Cognitive Services avec les conteneurs de l’API Visage offre une détection démographique, émotionnelle et unique des visiteurs sur le réseau privé de Contoso.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-147">The Azure Cognitive Services RP with Face API containers provides demographic, emotion, and unique visitor detection on Contoso's private network.</span></span> |
| | <span data-ttu-id="a7a2f-148">Stockage Blob</span><span class="sxs-lookup"><span data-stu-id="a7a2f-148">Blob Storage</span></span> | <span data-ttu-id="a7a2f-149">Les images capturées à partir du kit de développement d’intelligence artificielle sont chargées sur le stockage Blob Azure Stack Hub.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-149">Images captured from the AI Dev Kit are uploaded to Azure Stack Hub's blob storage.</span></span> |
| | <span data-ttu-id="a7a2f-150">Azure Functions</span><span class="sxs-lookup"><span data-stu-id="a7a2f-150">Azure Functions</span></span> | <span data-ttu-id="a7a2f-151">Une fonction Azure s’exécutant sur Azure Stack Hub reçoit les données du stockage blob et gère les interactions avec l’API Visage.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-151">An Azure Function running on Azure Stack Hub receives input from blob storage and manages the interactions with the Face API.</span></span> <span data-ttu-id="a7a2f-152">Elle transmet des données anonymisées vers un cluster Event Hubs qui se trouve dans Azure.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-152">It emits anonymized data to an Event Hubs cluster located in Azure.</span></span><br><br>|

## <a name="issues-and-considerations"></a><span data-ttu-id="a7a2f-153">Problèmes et considérations</span><span class="sxs-lookup"><span data-stu-id="a7a2f-153">Issues and considerations</span></span>

<span data-ttu-id="a7a2f-154">Prenez en compte des points suivants lors du choix de l'implémentation de cette solution :</span><span class="sxs-lookup"><span data-stu-id="a7a2f-154">Consider the following points when deciding how to implement this solution:</span></span>

### <a name="scalability"></a><span data-ttu-id="a7a2f-155">Extensibilité</span><span class="sxs-lookup"><span data-stu-id="a7a2f-155">Scalability</span></span>

<span data-ttu-id="a7a2f-156">Pour permettre à cette solution de s'adapter à plusieurs caméras et emplacements, vous devez vous assurer que tous les composants peuvent gérer cette surcharge.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-156">To enable this solution to scale across multiple cameras and locations, you'll need to make sure that all of the components can handle the increased load.</span></span> <span data-ttu-id="a7a2f-157">Vous devrez peut-être prendre des mesures comme :</span><span class="sxs-lookup"><span data-stu-id="a7a2f-157">You may need to take actions like:</span></span>

- <span data-ttu-id="a7a2f-158">Augmenter le nombre d’unités de streaming Stream Analytics.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-158">Increase the number of Stream Analytics streaming units.</span></span>
- <span data-ttu-id="a7a2f-159">Effectuer un scale-out du déploiement de l’API Visage.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-159">Scale out the Face API deployment.</span></span>
- <span data-ttu-id="a7a2f-160">Augmenter le débit du cluster Event Hubs.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-160">Increase the Event Hubs cluster throughput.</span></span>
- <span data-ttu-id="a7a2f-161">Dans les cas extrêmes, il peut être nécessaire de migrer des fonctions Azure vers une machine virtuelle.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-161">For extreme cases, migrate from Azure Functions to a virtual machine may be necessary.</span></span>

### <a name="availability"></a><span data-ttu-id="a7a2f-162">Disponibilité</span><span class="sxs-lookup"><span data-stu-id="a7a2f-162">Availability</span></span>

<span data-ttu-id="a7a2f-163">Comme cette solution comporte plusieurs niveaux, il est important de réfléchir à la façon de faire face aux pannes de réseau ou d'électricité.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-163">Since this solution is tiered, it's important to think about how to deal with networking or power failures.</span></span> <span data-ttu-id="a7a2f-164">Selon les besoins métier, vous pouvez mettre en place un mécanisme permettant de mettre en cache des images localement, puis de les transférer vers Azure Stack Hub quand la connectivité est rétablie.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-164">Depending on business needs, you might want to implement a mechanism to cache images locally, then forward to Azure Stack Hub when connectivity returns.</span></span> <span data-ttu-id="a7a2f-165">Si l'emplacement est suffisamment grand, le déploiement d'un appareil Data Box Edge avec le conteneur API Visage sur cet emplacement peut être préférable.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-165">If the location is large enough, deploying a Data Box Edge with the Face API container to that location might be a better option.</span></span>

### <a name="manageability"></a><span data-ttu-id="a7a2f-166">Simplicité de gestion</span><span class="sxs-lookup"><span data-stu-id="a7a2f-166">Manageability</span></span>

<span data-ttu-id="a7a2f-167">Cette solution peut couvrir de nombreux appareils et emplacements, et donc devenir difficile à gérer.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-167">This solution can span many devices and locations, which could get unwieldy.</span></span> <span data-ttu-id="a7a2f-168">Les [services IoT d’Azure](/azure/iot-fundamentals/) peuvent être utilisés pour mettre automatiquement en ligne de nouveaux emplacements et appareils et les maintenir à jour.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-168">[Azure's IoT services](/azure/iot-fundamentals/) can be used to automatically bring new locations and devices online and keep them up to date.</span></span>

### <a name="security"></a><span data-ttu-id="a7a2f-169">Sécurité</span><span class="sxs-lookup"><span data-stu-id="a7a2f-169">Security</span></span>

<span data-ttu-id="a7a2f-170">Cette solution capturant des images des clients, la sécurité revêt ici une importance critique.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-170">This solution captures customer images, making security a paramount consideration.</span></span> <span data-ttu-id="a7a2f-171">Assurez-vous que tous les comptes de stockage sont sécurisés à l’aide des stratégies d’accès appropriées et modifiez les clés régulièrement.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-171">Make sure all storage accounts are secured with the proper access policies and rotate keys regularly.</span></span> <span data-ttu-id="a7a2f-172">Veillez à ce que les comptes de stockage et Event Hubs disposent de stratégies de rétention conformes aux règlements sur la protection des informations personnelles définies par l'entreprise et le gouvernement.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-172">Ensure storage accounts and Event Hubs have retention policies that meet corporate and government privacy regulations.</span></span> <span data-ttu-id="a7a2f-173">Veillez également à hiérarchiser les niveaux d’accès utilisateur.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-173">Also make sure to tier the user access levels.</span></span> <span data-ttu-id="a7a2f-174">La hiérarchisation garantit que les utilisateurs ont uniquement accès aux données dont ils ont besoin pour leur rôle.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-174">Tiering ensures that users only have access to the data they need for their role.</span></span>

## <a name="next-steps"></a><span data-ttu-id="a7a2f-175">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="a7a2f-175">Next steps</span></span>

<span data-ttu-id="a7a2f-176">Pour en savoir plus sur les sujets abordés dans cet article :</span><span class="sxs-lookup"><span data-stu-id="a7a2f-176">To learn more about the topics introduced in this article:</span></span>

- <span data-ttu-id="a7a2f-177">Consultez le [modèle Données hiérarchisées](https://aka.ms/tiereddatadeploy), qui est exploité par le modèle de détection des pas.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-177">See the [Tiered Data pattern](https://aka.ms/tiereddatadeploy), which is leveraged by the footfall detection pattern.</span></span>
- <span data-ttu-id="a7a2f-178">Pour en savoir plus sur l’utilisation de Custom Vision, consultez le [Kit de développement d’intelligence artificielle Custom Vision](https://azure.github.io/Vision-AI-DevKit-Pages/).</span><span class="sxs-lookup"><span data-stu-id="a7a2f-178">See the [Custom Vision AI Dev Kit](https://azure.github.io/Vision-AI-DevKit-Pages/) to learn more about using custom vision.</span></span> 

<span data-ttu-id="a7a2f-179">Lorsque vous êtes prêt à tester l’exemple de solution, poursuivez avec le [Guide de déploiement de la solution de détection des pas](solution-deployment-guide-retail-footfall-detection.md).</span><span class="sxs-lookup"><span data-stu-id="a7a2f-179">When you're ready to test the solution example, continue with the [Footfall detection deployment guide](solution-deployment-guide-retail-footfall-detection.md).</span></span> <span data-ttu-id="a7a2f-180">Ce guide de déploiement fournit des instructions pas à pas sur le déploiement et sur le test de ses composants.</span><span class="sxs-lookup"><span data-stu-id="a7a2f-180">The deployment guide provides step-by-step instructions for deploying and testing its components.</span></span>
